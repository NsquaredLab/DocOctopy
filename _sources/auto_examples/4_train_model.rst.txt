
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/4_train_model.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_4_train_model.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_4_train_model.py:


Training a deep learning model
===========================

This example shows how to train a deep learning model using the dataset created in the previous example.

.. GENERATED FROM PYTHON SOURCE LINES 9-18

Loading the dataset
-------------------
To load the dataset we need to use the EMGDatasetLoader class.

Two parameters are required:

- data_path: Path to the dataset file.

- dataloader_parameters: Parameters for the DataLoader.

.. GENERATED FROM PYTHON SOURCE LINES 18-22

.. code-block:: Python

    from doc_octopy.datasets.loader import EMGDatasetLoader

    loader = EMGDatasetLoader("data/dataset.zarr", dataloader_parameters={"batch_size": 16, "drop_last": True})








.. GENERATED FROM PYTHON SOURCE LINES 23-25

Training the model
------------------

.. GENERATED FROM PYTHON SOURCE LINES 25-57

.. code-block:: Python

    from doc_octopy.models.definitions.raul_net.online.v16 import RaulNetV16
    import lightning as L

    # Create the model
    model = RaulNetV16(
        learning_rate=1e-4,
        nr_of_input_channels=2,
        input_length__samples=192,
        nr_of_outputs=60,
        nr_of_electrode_grids=5,
        nr_of_electrodes_per_grid=64,

        # Multiply following by 4, 8, 16 to have a useful network
        cnn_encoder_channels=(4, 1, 1),
        mlp_encoder_channels=(8, 8),

        event_search_kernel_length=31,
        event_search_kernel_stride=8,
    )

    trainer = L.Trainer(
        accelerator="auto",
        devices=1,
        precision="16-mixed",
        max_epochs=1,
        log_every_n_steps=50,
        logger=None,
        enable_checkpointing=False,
        deterministic=False,
    )

    trainer.fit(model, datamodule=loader)


.. rst-class:: sphx-glr-script-out

.. code-block:: pytb

    Traceback (most recent call last):
      File "/home/runner/work/DocOctopy/DocOctopy/examples/4_train_model.py", line 56, in <module>
        trainer.fit(model, datamodule=loader)
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 538, in fit
        call._call_and_handle_interrupt(
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 47, in _call_and_handle_interrupt
        return trainer_fn(*args, **kwargs)
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 574, in _fit_impl
        self._run(model, ckpt_path=ckpt_path)
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 957, in _run
        self.strategy.setup(self)
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 158, in setup
        self.setup_optimizers(trainer)
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/strategies/strategy.py", line 138, in setup_optimizers
        self.optimizers, self.lr_scheduler_configs = _init_optimizers_and_lr_schedulers(self.lightning_module)
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/core/optimizer.py", line 179, in _init_optimizers_and_lr_schedulers
        optim_conf = call._call_lightning_module_hook(model.trainer, "configure_optimizers", pl_module=model)
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 167, in _call_lightning_module_hook
        output = fn(*args, **kwargs)
      File "/home/runner/work/DocOctopy/DocOctopy/doc_octopy/models/definitions/raul_net/online/v16.py", line 154, in configure_optimizers
        total_steps=self.trainer.estimated_stepping_batches,
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/trainer/trainer.py", line 1675, in estimated_stepping_batches
        self.fit_loop.setup_data()
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/loops/fit_loop.py", line 225, in setup_data
        train_dataloader = _request_dataloader(source)
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/trainer/connectors/data_connector.py", line 325, in _request_dataloader
        return data_source.dataloader()
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/trainer/connectors/data_connector.py", line 292, in dataloader
        return call._call_lightning_datamodule_hook(self.instance.trainer, self.name)
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/pytorch/trainer/call.py", line 189, in _call_lightning_datamodule_hook
        return fn(*args, **kwargs)
      File "/home/runner/work/DocOctopy/DocOctopy/doc_octopy/datasets/loader.py", line 126, in train_dataloader
        self._EMGDatasetLoader(
      File "/home/runner/work/DocOctopy/DocOctopy/doc_octopy/datasets/loader.py", line 42, in __init__
        self._emg_data = zarr.open(str(self.zarr_file))[self.subset_name]["emg"]
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/zarr/hierarchy.py", line 511, in __getitem__
        raise KeyError(item)
    KeyError: 'training'





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.590 seconds)

**Estimated memory usage:**  1369 MB


.. _sphx_glr_download_auto_examples_4_train_model.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: 4_train_model.ipynb <4_train_model.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: 4_train_model.py <4_train_model.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: 4_train_model.zip <4_train_model.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
