
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/4_train_model.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_4_train_model.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_4_train_model.py:


Training a deep learning model
===========================

This example shows how to train a deep learning model using the dataset created in the previous example.

.. GENERATED FROM PYTHON SOURCE LINES 9-18

Loading the dataset
-------------------
To load the dataset we need to use the EMGDatasetLoader class.

Two parameters are required:

- data_path: Path to the dataset file.

- dataloader_parameters: Parameters for the DataLoader.

.. GENERATED FROM PYTHON SOURCE LINES 18-23

.. code-block:: Python

    from pathlib import Path
    from doc_octopy.datasets.loader import EMGDatasetLoader

    loader = EMGDatasetLoader(Path("data/dataset.zarr").resolve(), dataloader_parameters={"batch_size": 16, "drop_last": True})



.. rst-class:: sphx-glr-script-out

.. code-block:: pytb

    Traceback (most recent call last):
      File "/home/runner/work/DocOctopy/DocOctopy/examples/4_train_model.py", line 19, in <module>
        from doc_octopy.datasets.loader import EMGDatasetLoader
      File "/home/runner/work/DocOctopy/DocOctopy/doc_octopy/datasets/loader.py", line 6, in <module>
        import lightning as L
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/__init__.py", line 18, in <module>
        from lightning.fabric.fabric import Fabric  # noqa: E402
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/fabric/__init__.py", line 30, in <module>
        from lightning.fabric.fabric import Fabric  # noqa: E402
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/fabric/fabric.py", line 46, in <module>
        from lightning.fabric.loggers import Logger
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/fabric/loggers/__init__.py", line 15, in <module>
        from lightning.fabric.loggers.tensorboard import TensorBoardLogger  # noqa: F401
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/fabric/loggers/tensorboard.py", line 30, in <module>
        from lightning.fabric.wrappers import _unwrap_objects
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/lightning/fabric/wrappers.py", line 38, in <module>
        from torch._dynamo import OptimizedModule
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/torch/_dynamo/__init__.py", line 3, in <module>
        from . import convert_frame, eval_frame, resume_execution
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/torch/_dynamo/convert_frame.py", line 53, in <module>
        from . import config, exc, trace_rules
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/torch/_dynamo/trace_rules.py", line 46, in <module>
        from .variables import (
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/torch/_dynamo/variables/__init__.py", line 104, in <module>
        from .torch import TorchCtxManagerClassVariable, TorchInGraphFunctionVariable
      File "/home/runner/work/DocOctopy/DocOctopy/.venv/lib/python3.10/site-packages/torch/_dynamo/variables/torch.py", line 142, in <module>
        torch._dynamo.external_utils.is_compiling: True,
    AttributeError: partially initialized module 'torch._dynamo' has no attribute 'external_utils' (most likely due to a circular import)




.. GENERATED FROM PYTHON SOURCE LINES 24-26

Training the model
------------------

.. GENERATED FROM PYTHON SOURCE LINES 26-58

.. code-block:: Python

    from doc_octopy.models.definitions.raul_net.online.v16 import RaulNetV16
    import lightning as L

    # Create the model
    model = RaulNetV16(
        learning_rate=1e-4,
        nr_of_input_channels=2,
        input_length__samples=192,
        nr_of_outputs=60,
        nr_of_electrode_grids=5,
        nr_of_electrodes_per_grid=64,

        # Multiply following by 4, 8, 16 to have a useful network
        cnn_encoder_channels=(4, 1, 1),
        mlp_encoder_channels=(8, 8),

        event_search_kernel_length=31,
        event_search_kernel_stride=8,
    )

    trainer = L.Trainer(
        accelerator="auto",
        devices=1,
        precision="16-mixed",
        max_epochs=1,
        log_every_n_steps=50,
        logger=None,
        enable_checkpointing=False,
        deterministic=False,
    )

    trainer.fit(model, datamodule=loader)


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.038 seconds)

**Estimated memory usage:**  1650 MB


.. _sphx_glr_download_auto_examples_4_train_model.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: 4_train_model.ipynb <4_train_model.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: 4_train_model.py <4_train_model.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: 4_train_model.zip <4_train_model.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
